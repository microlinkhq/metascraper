name: test
on: [push, pull_request]
env:
  CI: true
jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package:
          - metascraper
          - metascraper-amazon
          - metascraper-audio
          - metascraper-author
          - metascraper-clearbit
          - metascraper-date
          - metascraper-description
          - metascraper-helpers
          - metascraper-iframe
          - metascraper-image
          - metascraper-lang
          - metascraper-logo
          - metascraper-logo-favicon
          - metascraper-media-provider
          - metascraper-publisher
          - metascraper-readability
          - metascraper-soundcloud
          - metascraper-spotify
          - metascraper-telegram
          - metascraper-title
          - metascraper-uol
          - metascraper-url
          - metascraper-video
          - metascraper-youtube
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '15'
      - name: Install
        run: npm install
      - name: Test
        run: cd packages/${{ matrix['package'] }} && npm test
  coverage:
    name: Coverage
    needs: test
    runs-on: ubuntu-latest
    steps:
    - run: nyc report --reporter=text-lcov
    - uses: coverallsapp/github-action@master
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
